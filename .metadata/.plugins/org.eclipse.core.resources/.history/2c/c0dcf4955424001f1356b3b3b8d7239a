package com.learnmicroservices.cards.services.impl;

import java.util.Optional;
import java.util.Random;

import org.springframework.stereotype.Service;

import com.learnmicroservices.cards.dto.CardDto;
import com.learnmicroservices.cards.entity.Card;
import com.learnmicroservices.cards.exceptions.CardAlreadyExistsException;
import com.learnmicroservices.cards.repository.CardRepository;
import com.learnmicroservices.cards.services.ICardService;

import lombok.AllArgsConstructor;
import lombok.extern.slf4j.Slf4j;

@Service
@AllArgsConstructor // allow dependency Injection
@Slf4j
public class CardServiceImpl implements ICardService{
	
	private CardRepository cardRepository;

	@Override
	public void createCard(String mobileNumber) {
		log.info("CardServiceImpl :: createCard");
		Optional<Card> optionalCard = cardRepository.findByMobileNumber(mobileNumber);
		
		if(optionalCard.isPresent()) {
				throw new CardAlreadyExistsException("Card Already Exists with given Mobile Number : "+mobileNumber);	
		}
		createNewCard(mobileNumber);
		
	}
	
	private void createNewCard(String mobileNumber) {
		
		Card card = new Card();
		
		long randomNumber = 100000000L + new Random().nextInt(90000);
		card.setCardNumber(String.valueOf(randomNumber));
		card.setMobileNumber(mobileNumber);
		card.setCardType("CREDIT_CARD");
		card.setAvailableAmount(1000000);
		card.setAmountUsed(0);
		card.setTotalLimit(1000000);
		
		cardRepository.save(card);
		
	}

	@Override
	public CardDto fetchCard(String mobileNumber) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public boolean updateCard(CardDto cardDto) {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public boolean deleteCard(String mobileNumber) {
		// TODO Auto-generated method stub
		return false;
	}
	
	

}
